describe("getDataFromApi factory functions to retrieve data from play API to the app", function() {

  //////////
  //Mocks //
  //////////

  var getDataFromApiFactory, $httpBackend;

  var groups = [
  {"assets":[{"assetId":"Pulsera_001","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"description":"","enable":true,"externalId":"Pulsera_001","family":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"descripcion":"eNest es una solución personal avanzada de seguridad que permite al usuario alertar sobre situaciones de emergencia, y estar localizado en todo momento y en cualquier lugar","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":22,"version":0},"id":70,"name":"eNest","version":0},"id":40,"location":"","rule":{"assetFamily":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"descripcion":"eNest es una solución personal avanzada de seguridad que permite al usuario alertar sobre situaciones de emergencia, y estar localizado en todo momento y en cualquier lugar","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":22,"version":0},"id":70,"name":"eNest","version":0},"author":"luis","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"fcreation":1422355930000,"id":56,"name":"AlertaDistanciaSeguridad","path":"com.altran.kharonte.middleware.rulesengine.AlertaDistanciaSeguridad","source":"WHEN (PAYLOAD.distanceToHome > 1000) THEN\n\talert(\"alertaDistancia\",4)\nEND ","version":6},"version":2,"$$hashKey":"object:38"},{"assetId":"Cam_001","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"description":"","enable":true,"externalId":"Cam_001","family":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"descripcion":"Cámara IP FI8910W","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":23,"version":0},"id":71,"name":"FI8910W","version":0},"id":41,"location":"41.35890136704563, 2.0997726917266846","rule":{"assetFamily":{"company":{"id":1,"nombre":"Altran","tipoContrato":"ENTERPRISE","version":0},"descripcion":"Generic family","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":1,"version":0},"id":1,"name":"Generic","version":0},"author":"Altran","company":{"id":1,"nombre":"Altran","tipoContrato":"ENTERPRISE","version":0},"fcreation":1398424271000,"id":1,"name":"NoRule","path":"","source":null,"version":0},"version":0,"$$hashKey":"object:39"}],"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"id":2,"name":"Elder_001","version":0,"dbName":"Andrés Pajares","$$hashKey":"object:23"},{"assets":[{"assetId":"Cam_002","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"description":"Cámara para User_002","enable":true,"externalId":"","family":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"descripcion":"Cámara IP FI8910W","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":23,"version":0},"id":71,"name":"FI8910W","version":0},"id":44,"location":"41.36624520292533, 2.1280860900878906","rule":{"assetFamily":{"company":{"id":1,"nombre":"Altran","tipoContrato":"ENTERPRISE","version":0},"descripcion":"Generic family","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":1,"version":0},"id":1,"name":"Generic","version":0},"author":"Altran","company":{"id":1,"nombre":"Altran","tipoContrato":"ENTERPRISE","version":0},"fcreation":1398424271000,"id":1,"name":"NoRule","path":"","source":null,"version":0},"version":0,"$$hashKey":"object:42"},{"assetId":"Pulsera_002","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"description":"Pulsera para User_002","enable":true,"externalId":"","family":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"descripcion":"eNest es una solución personal avanzada de seguridad que permite al usuario alertar sobre situaciones de emergencia, y estar localizado en todo momento y en cualquier lugar","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":22,"version":0},"id":70,"name":"eNest","version":0},"id":43,"location":"","rule":{"assetFamily":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"descripcion":"eNest es una solución personal avanzada de seguridad que permite al usuario alertar sobre situaciones de emergencia, y estar localizado en todo momento y en cualquier lugar","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":22,"version":0},"id":70,"name":"eNest","version":0},"author":"luis","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"fcreation":1422355930000,"id":56,"name":"AlertaDistanciaSeguridad","path":"com.altran.kharonte.middleware.rulesengine.AlertaDistanciaSeguridad","source":"WHEN (PAYLOAD.distanceToHome > 1000) THEN\n\talert(\"alertaDistancia\",4)\nEND ","version":6},"version":5,"$$hashKey":"object:43"}],"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"id":4,"name":"Elder_003","version":1,"$$hashKey":"object:24"},{"assets":[{"assetId":"Camara_003","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"description":"Camara para user_003","enable":true,"externalId":"","family":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"descripcion":"Cámara IP FI8910W","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":23,"version":0},"id":71,"name":"FI8910W","version":0},"id":46,"location":"41.35825713137813, 2.117142677307129","rule":{"assetFamily":{"company":{"id":1,"nombre":"Altran","tipoContrato":"ENTERPRISE","version":0},"descripcion":"Generic family","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":1,"version":0},"id":1,"name":"Generic","version":0},"author":"Altran","company":{"id":1,"nombre":"Altran","tipoContrato":"ENTERPRISE","version":0},"fcreation":1398424271000,"id":1,"name":"NoRule","path":"","source":null,"version":0},"version":0,"$$hashKey":"object:46"},{"assetId":"Pulsera_003","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"description":"Pulsera para user_003","enable":true,"externalId":"","family":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"descripcion":"eNest es una solución personal avanzada de seguridad que permite al usuario alertar sobre situaciones de emergencia, y estar localizado en todo momento y en cualquier lugar","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":22,"version":0},"id":70,"name":"eNest","version":0},"id":45,"location":"","rule":{"assetFamily":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"descripcion":"eNest es una solución personal avanzada de seguridad que permite al usuario alertar sobre situaciones de emergencia, y estar localizado en todo momento y en cualquier lugar","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":22,"version":0},"id":70,"name":"eNest","version":0},"author":"luis","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"fcreation":1422355930000,"id":56,"name":"AlertaDistanciaSeguridad","path":"com.altran.kharonte.middleware.rulesengine.AlertaDistanciaSeguridad","source":"WHEN (PAYLOAD.distanceToHome > 1000) THEN\n\talert(\"alertaDistancia\",4)\nEND ","version":6},"version":0,"$$hashKey":"object:47"}],"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"id":5,"name":"Elder_004","version":1,"$$hashKey":"object:25"},{"assets":[{"assetId":"Camara_004","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"description":"Camara para user004","enable":true,"externalId":"","family":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"descripcion":"Cámara IP FI8910W","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":23,"version":0},"id":71,"name":"FI8910W","version":0},"id":48,"location":"41.370110046816414, 2.106499671936035","rule":{"assetFamily":{"company":{"id":1,"nombre":"Altran","tipoContrato":"ENTERPRISE","version":0},"descripcion":"Generic family","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":1,"version":0},"id":1,"name":"Generic","version":0},"author":"Altran","company":{"id":1,"nombre":"Altran","tipoContrato":"ENTERPRISE","version":0},"fcreation":1398424271000,"id":1,"name":"NoRule","path":"","source":null,"version":0},"version":0,"$$hashKey":"object:50"},{"assetId":"Pulsera_004","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"description":"Pulsera para user004","enable":true,"externalId":"","family":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"descripcion":"eNest es una solución personal avanzada de seguridad que permite al usuario alertar sobre situaciones de emergencia, y estar localizado en todo momento y en cualquier lugar","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":22,"version":0},"id":70,"name":"eNest","version":0},"id":47,"location":"","rule":{"assetFamily":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"descripcion":"eNest es una solución personal avanzada de seguridad que permite al usuario alertar sobre situaciones de emergencia, y estar localizado en todo momento y en cualquier lugar","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":22,"version":0},"id":70,"name":"eNest","version":0},"author":"luis","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"fcreation":1422355930000,"id":56,"name":"AlertaDistanciaSeguridad","path":"com.altran.kharonte.middleware.rulesengine.AlertaDistanciaSeguridad","source":"WHEN (PAYLOAD.distanceToHome > 1000) THEN\n\talert(\"alertaDistancia\",4)\nEND ","version":6},"version":0,"$$hashKey":"object:51"}],"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"id":6,"name":"Elder_002","version":1,"dbName":"Fernando Esteso","$$hashKey":"object:26"},{"assets":[{"assetId":"Pulsera_005","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"description":"Pulsera para user005","enable":true,"externalId":"","family":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"descripcion":"eNest es una solución personal avanzada de seguridad que permite al usuario alertar sobre situaciones de emergencia, y estar localizado en todo momento y en cualquier lugar","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":22,"version":0},"id":70,"name":"eNest","version":0},"id":49,"location":"","rule":{"assetFamily":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"descripcion":"eNest es una solución personal avanzada de seguridad que permite al usuario alertar sobre situaciones de emergencia, y estar localizado en todo momento y en cualquier lugar","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":22,"version":0},"id":70,"name":"eNest","version":0},"author":"luis","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"fcreation":1422355930000,"id":56,"name":"AlertaDistanciaSeguridad","path":"com.altran.kharonte.middleware.rulesengine.AlertaDistanciaSeguridad","source":"WHEN (PAYLOAD.distanceToHome > 1000) THEN\n\talert(\"alertaDistancia\",4)\nEND ","version":6},"version":0,"$$hashKey":"object:54"},{"assetId":"Camara_005","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"description":"","enable":true,"externalId":"","family":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"descripcion":"Cámara IP FI8910W","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":23,"version":0},"id":71,"name":"FI8910W","version":0},"id":50,"location":"41.35973886387978, 2.1121859550476074","rule":{"assetFamily":{"company":{"id":1,"nombre":"Altran","tipoContrato":"ENTERPRISE","version":0},"descripcion":"Generic family","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":1,"version":0},"id":1,"name":"Generic","version":0},"author":"Altran","company":{"id":1,"nombre":"Altran","tipoContrato":"ENTERPRISE","version":0},"fcreation":1398424271000,"id":1,"name":"NoRule","path":"","source":null,"version":0},"version":0,"$$hashKey":"object:55"}],"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":1},"id":7,"name":"Elder_005","version":1,"dbName":"Concha Velasco","$$hashKey":"object:27"}
  ];
  var alertsPromise = {};
  alertsPromise.data = [{"fecha":1425636868000,"id":134,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1425470721000,"id":126,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1425470718000,"id":125,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1425399652000,"id":115,"level":4,"msg":"alertaDistancia","version":0}];
  var responsePayload = {};
  responsePayload.data = [{"assetId":"Pulsera_001","data":{"distanceToHome":1677.5696084053523,"location":"41.372768, 2.1076696666666668"},"ts":1425636868494}];
  var payloadsPromise = {};
  payloadsPromise.data = [{"userId":"Elder_001","payloads":[{"assetId":"Pulsera_001","data":{"distanceToHome":1677.5696,"location":"41.372768, 2.1076696666666668"},"ts":1425636868494}]},{"userId":"Elder_003","payloads":[{"assetId":"Pulsera_002","data":{"distanceToHome":3431.9465,"location":"41.384068, 2.124903"},"ts":1425911217169}]},{"userId":"Elder_004","payloads":[{"assetId":"Pulsera_003","data":{"distanceToHome":220.86494,"location":"41.35863466666667, 2.1050696666666666"},"ts":1425911204297}]},{"userId":"Elder_002","payloads":[{"assetId":"Pulsera_004","data":{"distanceToHome":2946.2788,"location":"41.384468, 2.107203"},"ts":1425911229074}]},{"userId":"Elder_005","payloads":[{"assetId":"Pulsera_005","data":{"distanceToHome":3145.568,"location":"41.379467999999996, 2.127303"},"ts":1425399641427}]}];
  var userAssets = {};
  userAssets = {"assets":[{"assetId":"Pulsera_001","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":2},"description":"","enable":true,"externalId":"Pulsera_001","family":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":2},"descripcion":"eNest es una solución personal avanzada de seguridad que permite al usuario alertar sobre situaciones de emergencia, y estar localizado en todo momento y en cualquier lugar","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":22,"version":0},"id":70,"name":"eNest","version":0},"id":40,"location":"","rule":{"assetFamily":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":2},"descripcion":"eNest es una solución personal avanzada de seguridad que permite al usuario alertar sobre situaciones de emergencia, y estar localizado en todo momento y en cualquier lugar","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":22,"version":0},"id":70,"name":"eNest","version":0},"author":"luis","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":2},"fcreation":1422355930000,"id":56,"name":"AlertaDistanciaSeguridad","path":"com.altran.kharonte.middleware.rulesengine.AlertaDistanciaSeguridad","source":"WHEN (PAYLOAD.distanceToHome > 1000) THEN\n\talert(\"alertaDistancia\",4)\nEND ","version":6},"version":2},{"assetId":"Cam_001","company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":2},"description":"","enable":true,"externalId":"Cam_001","family":{"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":2},"descripcion":"Cámara IP FI8910W","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":23,"version":0},"id":71,"name":"FI8910W","version":0},"id":41,"location":"41.35890136704563, 2.0997726917266846","rule":{"assetFamily":{"company":{"id":1,"nombre":"Altran","tipoContrato":"ENTERPRISE","version":0},"descripcion":"Generic family","familyPrivacyFlags":{"AADC":false,"ATRS":false,"GDSA":false,"ILMAEDP":false,"RAEM":false,"VIS":false,"VISDAS":false,"VISMicroAggregation":false,"erasable":false,"id":1,"version":0},"id":1,"name":"Generic","version":0},"author":"Altran","company":{"id":1,"nombre":"Altran","tipoContrato":"ENTERPRISE","version":0},"fcreation":1398424271000,"id":1,"name":"NoRule","path":"","source":null,"version":0},"version":0}],"company":{"id":5,"nombre":"Orange","tipoContrato":"ENTERPRISE","version":2},"id":2,"name":"Elder_001","version":0};
  var allUserAlerts = {};
  allUserAlerts.data = [{"fecha":1426069319000,"id":147,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1426069316000,"id":146,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1426069310000,"id":145,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1426069307000,"id":144,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1425636868000,"id":134,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1425470721000,"id":126,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1425470718000,"id":125,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1425399652000,"id":115,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1425284408000,"id":106,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1425284405000,"id":105,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1424861758000,"id":96,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1424791025000,"id":92,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1424791022000,"id":91,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1424680180000,"id":82,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1424680177000,"id":81,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1424456088000,"id":77,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1424334378000,"id":68,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1424334377000,"id":67,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1424246702000,"id":62,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1424246699000,"id":61,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1424246696000,"id":60,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1424246693000,"id":59,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1423671193000,"id":45,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1423671190000,"id":44,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1423671188000,"id":43,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1423561426000,"id":38,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1423416869000,"id":32,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1423416864000,"id":31,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1423416859000,"id":30,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1423416854000,"id":29,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1423039641000,"id":18,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1423039631000,"id":17,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1422872959000,"id":10,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1422872949000,"id":9,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1422444663000,"id":7,"level":4,"msg":"alertaDistancia","version":0},{"fecha":1422443600000,"id":6,"level":1,"msg":"Anciano fuera de rango","version":0},{"fecha":1422442990000,"id":5,"level":1,"msg":"Anciano fuera de rango","version":0},{"fecha":1422439877000,"id":4,"level":1,"msg":"Anciano fuera de rango","version":0},{"fecha":1422438870000,"id":3,"level":1,"msg":"Anciano fuera de rango","version":0},{"fecha":1422437775000,"id":2,"level":1,"msg":"Anciano fuera de rango","version":0},{"fecha":1422437699000,"id":1,"level":1,"msg":"Anciano fuera de rango","version":0}];
  
  beforeEach(module("play"));

  beforeEach(inject(function (_getDataFromApiFactory_, $injector, ajaxFactory, $q) {
  	$httpBackend = $injector.get('$httpBackend');

    getDataFromApiFactory = _getDataFromApiFactory_;

    spyOn(ajaxFactory, "getAssetAlerts").andCallFake(function() {
        var deferred = $q.defer();
        deferred.resolve(alertsPromise);
        return deferred.promise;
    });

    spyOn(ajaxFactory, "getAssetLatestPayloads").andCallFake(function() {
        var deferred = $q.defer();
        deferred.resolve(responsePayload);
        return deferred.promise;
    });
    
    spyOn(ajaxFactory, "getUserAssets").andCallFake(function() {
        var deferred = $q.defer();
        deferred.resolve(userAssets);
        return deferred.promise;
    });

  }));


  //////////
  //Tests //
  //////////
  it("should have a getAssetAlertsLast7days() function which take a assetId and returns all the alerts in the past 7 days from this asset", function(){
  	var test = getDataFromApiFactory.getAssetAlertsLast7days("Pulsera_001");
  	var firstLevel = undefined;

  	var expectedFirstLevel = 4;

  	test.then(function(data){
  		firstLevel = data.data[0].level;
  	})

  	$httpBackend.verifyNoOutstandingExpectation();
  	expect(test).toBeDefined();

  	expect(firstLevel).toEqual(expectedFirstLevel);
  })

  it("should have a getAlertsLast7days() function which take a ajaxFactory.getGroups() response and fires a ajaxFactory.getAssetAlerts() to every asset in the group returning the alerts from the last 7 days", function(){
  	var test = undefined;
  	getDataFromApiFactory.getAlertsLast7days(groups).then(function(alerts){
  		test = alerts;
  	});
  	$httpBackend.verifyNoOutstandingExpectation();

  	expect(test).toBeDefined();

  	expect(test.data[0].userId).toEqual('Elder_001');
  	expect(test.data[0].alerts[0]).toEqual(alertsPromise.data[0]);

  })

  it("should have a getLatestsPayloads() function which take a ajaxFactory.getGroups() response and fires a ajaxFactory.getAssetLatestPayloads() to every asset in the group returning the latest payload from every asset (to obtain their position)", function(){
    var test = undefined;
    getDataFromApiFactory.getLatestsPayloads(groups).then(function(payloads){
      test = payloads;
    });
    $httpBackend.verifyNoOutstandingExpectation();

    expect(test).toBeDefined();

    expect(test.data[0].userId).toEqual("Elder_001")
    expect(test.data[0].payloads[0]).toEqual(responsePayload.data[0])
  })

  it("should have a getAllUserAlerts() function which take a userId string and returns the alerts from this user", function(){
    var test = undefined;
    getDataFromApiFactory.getAllUserAlerts("Elder_001").then(function(alerts){
      test = alerts;
    })

    $httpBackend.verifyNoOutstandingExpectation();

    expect(test).toBeDefined();
    expect(test[0]).toEqual(allUserAlerts.data[4]);
  })

})